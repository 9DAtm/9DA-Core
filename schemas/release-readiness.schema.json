{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/9DAtm/9DA/schemas/release-readiness.schema.json",
  "title": "9DA Release Readiness and Certification Schema",
  "type": "object",
  "additionalProperties": false,

  "required": [
    "governing_release_reference",
    "release_identity",
    "repositories_in_scope",
    "architecture_compliance",
    "dependency_compliance",
    "adr_compliance",
    "ethics_compliance",
    "integration_test_results",
    "versioning_and_migration",
    "metrics_snapshot",
    "final_attestation"
  ],

  "properties": {
    "governing_release_reference": {
      "type": "object",
      "required": ["document", "version"],
      "additionalProperties": false,
      "properties": {
        "document": {
          "type": "string",
          "const": "9DA-Core/RELEASE-PROCESS.md"
        },
        "version": {
          "type": "string",
          "minLength": 1
        }
      }
    },

    "release_identity": {
      "type": "object",
      "required": ["release_id", "release_type", "target_date"],
      "additionalProperties": false,
      "properties": {
        "release_id": {
          "type": "string",
          "pattern": "^9DA-[0-9]{4}-(Q[1-4]|EMERGENCY-[0-9]+)$"
        },
        "release_type": {
          "type": "string",
          "enum": ["Quarterly", "Emergency"]
        },
        "target_date": {
          "type": "string",
          "format": "date"
        },
        "emergency_justification": {
          "type": "string",
          "minLength": 30
        }
      }
    },

    "repositories_in_scope": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "type": "object",
        "required": ["name", "version", "layer"],
        "additionalProperties": false,
        "properties": {
          "name": {
            "type": "string",
            "enum": [
              "9DA-Core",
              "9DA-Specifications",
              "9DA-Design-Documents",
              "9DA-SDK",
              "9DA-Reference-Implementation",
              "9DA-Tools",
              "9DA-Examples",
              ".github"
            ]
          },
          "version": {
            "type": "string",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
          },
          "layer": {
            "type": "string",
            "enum": ["Conceptual", "Logical", "Physical", "Meta"]
          }
        },
        "allOf": [
          {
            "if": {
              "properties": {
                "name": {
                  "enum": ["9DA-Core", "9DA-Specifications"]
                }
              }
            },
            "then": {
              "properties": {
                "layer": {
                  "const": "Conceptual"
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": "9DA-Design-Documents"
                }
              }
            },
            "then": {
              "properties": {
                "layer": {
                  "const": "Logical"
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "enum": ["9DA-SDK", "9DA-Reference-Implementation", "9DA-Tools", "9DA-Examples"]
                }
              }
            },
            "then": {
              "properties": {
                "layer": {
                  "const": "Physical"
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "name": {
                  "const": ".github"
                }
              }
            },
            "then": {
              "properties": {
                "layer": {
                  "const": "Meta"
                }
              }
            }
          }
        ]
      }
    },

    "architecture_compliance": {
      "type": "object",
      "required": ["invariants_validated", "violations_detected"],
      "additionalProperties": false,
      "properties": {
        "invariants_validated": {
          "type": "boolean",
          "const": true
        },
        "violations_detected": {
          "type": "integer",
          "const": 0
        }
      }
    },

    "dependency_compliance": {
      "type": "object",
      "required": ["matrix_validated", "cycles_detected"],
      "additionalProperties": false,
      "properties": {
        "matrix_validated": {
          "type": "boolean",
          "const": true
        },
        "cycles_detected": {
          "type": "integer",
          "const": 0
        }
      }
    },

    "adr_compliance": {
      "type": "object",
      "required": ["all_structural_changes_covered", "unaccepted_adrs"],
      "additionalProperties": false,
      "properties": {
        "all_structural_changes_covered": {
          "type": "boolean",
          "const": true
        },
        "unaccepted_adrs": {
          "type": "integer",
          "const": 0
        }
      }
    },

    "ethics_compliance": {
      "type": "object",
      "required": ["ethics_schema_validated", "violations_detected"],
      "additionalProperties": false,
      "properties": {
        "ethics_schema_validated": {
          "type": "boolean",
          "const": true
        },
        "violations_detected": {
          "type": "integer",
          "const": 0
        }
      }
    },

    "integration_test_results": {
      "type": "object",
      "required": ["test_suite_version", "pass_rate"],
      "additionalProperties": false,
      "properties": {
        "test_suite_version": {
          "type": "string",
          "minLength": 1
        },
        "pass_rate": {
          "type": "number",
          "const": 100
        }
      }
    },

    "versioning_and_migration": {
      "type": "object",
      "required": ["breaking_changes_present", "migration_guides_complete"],
      "additionalProperties": false,
      "properties": {
        "breaking_changes_present": {
          "type": "boolean"
        },
        "migration_guides_complete": {
          "type": "boolean"
        }
      }
    },

    "metrics_snapshot": {
      "type": "object",
      "required": ["metrics_version", "all_thresholds_met"],
      "additionalProperties": false,
      "properties": {
        "metrics_version": {
          "type": "string",
          "minLength": 1
        },
        "all_thresholds_met": {
          "type": "boolean",
          "const": true
        }
      }
    },

    "final_attestation": {
      "type": "object",
      "required": ["attested_by", "attestation_role", "attestation_date", "release_certified"],
      "additionalProperties": false,
      "properties": {
        "attested_by": {
          "type": "string",
          "minLength": 3
        },
        "attestation_role": {
          "type": "string",
          "enum": ["9DA-Core-Maintainer", "Release-Auditor"]
        },
        "attestation_date": {
          "type": "string",
          "format": "date"
        },
        "release_certified": {
          "type": "boolean",
          "const": true
        }
      }
    }
  },

  "allOf": [
    {
      "if": {
        "properties": {
          "release_identity": {
            "properties": {
              "release_type": {
                "const": "Quarterly"
              }
            }
          }
        }
      },
      "then": {
        "properties": {
          "repositories_in_scope": {
            "contains": {
              "properties": {
                "name": {
                  "const": "9DA-Core"
                }
              }
            }
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "release_identity": {
            "properties": {
              "release_type": {
                "const": "Emergency"
              }
            }
          }
        }
      },
      "then": {
        "properties": {
          "release_identity": {
            "required": ["emergency_justification"]
          },
          "repositories_in_scope": {
            "maxItems": 3
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "versioning_and_migration": {
            "properties": {
              "breaking_changes_present": {
                "const": true
              }
            }
          }
        }
      },
      "then": {
        "properties": {
          "versioning_and_migration": {
            "properties": {
              "migration_guides_complete": {
                "const": true
              }
            }
          }
        }
      }
    }
  ]
}